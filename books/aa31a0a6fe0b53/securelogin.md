---
title: "セキュアなユーザーログインを実装するために"
---

LINEログインを使ってWEBアプリケーションを実装する場合に、いくつかの注意すべきことがあります。LINEログインではセキュリティの観点から実装時にチェックするべき項目をチェックリストとして公開されています。

# LINEログインのセキュリティチェックリスト

LINEログインのドキュメントでは、安全なアプリの実装をするためのチェックリストが公開されています。

https://developers.line.biz/ja/docs/line-login/security-checklist

このチェックリストにはいくつかの要件が記載されていますが、今回重要になるのが`token`と`state`です。今回のテーマの一つである、Auth.jsを用いることでセキュアな認証機能の実装を容易に行うことができます。

# セキュアなログインフロー

まずは、LINEログインを用いたユーザーログインの流れについて示した図を引用( https://developers.line.biz/ja/docs/line-login/integrate-line-login/#login-flow )して説明します。

![img](https://developers.line.biz/assets/img/web-login-flow.2af66354.svg)

私たちが実際にWEBアプリを作る際には、上のフロー図の`Web app`が関係している部分を実装する必要があります。とりあえず以下に実装すべき内容を示します。

- ユーザーがLINEアカウントでの`認証`と`認可`をするためのURLボタンを設置
  - URLには必ずLINEログインプラットフォームからの`リダイレクトURL`と`state`がクエリパラメータとして含めることが必要です。
- LINEログインプラットフォームからリダイレクトされた先で、`認可コード`と`state`を受け取る
  - `state`はWEBアプリ側で生成した`state`と一致することを確認する必要があります。
- LINEログインプラットフォームに`認可コード`を送り、`アクセストークン`を受け取ります。
  - LINEプラットフォームからLINEユーザーのプロファイルを取得するためには、`アクセストークン`を使用する必要があります。

ここで`認証`と`認可`という似たような用語が登場しましたが、それぞれには異なった意味があります。

# 認証と認可

まず認証とは何か？これはユーザー自身が本人であることを証明することです。簡単にいってしまうとユーザーがログインをすることを言います。
LINEログインでは、以下のようなログイン画面がユーザーの認証のために提供されています。

![img](https://developers.line.biz/assets/img/login-with-new-session.7620fe6f.png)

次に認可とは、これはWEBアプリなどのシステムがユーザーの情報にアクセスするための権限をユーザーが与えることを言います。
LINEログインでは、以下のようなユーザー同意画面が認可の機能として提供されています。

![img](https://developers.line.biz/assets/img/consent-screen-ja.54d8cffc.png)
